<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Raster Polygonizer Workflow • rasterpolygonizer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Raster Polygonizer Workflow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rasterpolygonizer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/raster-polygonizer-workflow.html">Raster Polygonizer Workflow</a>
    </li>
    <li>
      <a href="../articles/workflow_building_polygons_old.html">Raster Polygonizer Workflow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Raster Polygonizer Workflow</h1>
            
      

      <div class="hidden name"><code>raster-polygonizer-workflow.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="from-lidar-scan-to-building-footprint">From LiDAR Scan to Building Footprint<a class="anchor" aria-label="anchor" href="#from-lidar-scan-to-building-footprint"></a>
</h2>
<p><em>A complete workflow for extracting, filtering, and characterizing
rooftop polygons from aerial elevation data</em></p>
<hr>
<div class="section level3">
<h3 id="why-this-package">Why This Package?<a class="anchor" aria-label="anchor" href="#why-this-package"></a>
</h3>
<p>Heavy snow accumulation on rooftops is a serious safety concern in
cold climates — when loads grow too large, roofs can fail
catastrophically. Understanding and predicting this risk requires
detailed information about building geometry across entire cities, but
traditional manual surveys are slow, expensive, and limited in
scale.</p>
<p>Airborne LiDAR (Light Detection and Ranging) offers a powerful
alternative. By bouncing laser pulses off surfaces from an aircraft and
recording the return time, LiDAR produces dense, precise
three-dimensional maps of the built environment. Comparing scans taken
before and after a snowfall event makes it possible to measure rooftop
snow accumulation automatically — at city scale, for thousands of
buildings at once.</p>
<p><code>rasterpolygonizer</code> packages the full processing chain
needed to go from a raw LiDAR-derived elevation raster to a clean,
attributed set of building footprints, ready for snow load analysis,
engineering assessment, or any other rooftop-scale application.</p>
<hr>
</div>
<div class="section level3">
<h3 id="workflow-overview">Workflow Overview<a class="anchor" aria-label="anchor" href="#workflow-overview"></a>
</h3>
<p>The six functions in this package form a linear pipeline. Each step
produces output consumed by the next:</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="40%">
<col width="36%">
</colgroup>
<thead><tr class="header">
<th align="center">Step</th>
<th>Function</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td><code><a href="../reference/fill_ground_raster.html">fill_ground_raster()</a></code></td>
<td>Fill voids and smooth the elevation surface</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td><code><a href="../reference/extract_building_edges_to_polygons.html">extract_building_edges_to_polygons()</a></code></td>
<td>Detect elevation edges and close them into candidate polygons</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td><code><a href="../reference/clean_building_polygons.html">clean_building_polygons()</a></code></td>
<td>Shrink, simplify, and filter polygons by area</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td><code><a href="../reference/filter_by_ground_truth.html">filter_by_ground_truth()</a></code></td>
<td>Validate detections against a reference footprint layer</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td><code><a href="../reference/remove_invalid_polys.html">remove_invalid_polys()</a></code></td>
<td>Drop polygons with insufficient raster coverage</td>
</tr>
<tr class="even">
<td align="center">6a</td>
<td><code><a href="../reference/estimate_building_height.html">estimate_building_height()</a></code></td>
<td>Extract mean rooftop elevation per polygon</td>
</tr>
<tr class="odd">
<td align="center">6b</td>
<td><code><a href="../reference/roof_slope_RANSAC.html">roof_slope_RANSAC()</a></code></td>
<td>Fit robust planes and derive slope and aspect per roof</td>
</tr>
</tbody>
</table>
<p>Steps 6a and 6b are independent characterization steps — run either
or both depending on your analysis goals.</p>
<hr>
</div>
<div class="section level3">
<h3 id="load-example-data">Load Example Data<a class="anchor" aria-label="anchor" href="#load-example-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">load_extdata</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">filename</span>, <span class="va">pkg</span> <span class="op">=</span> <span class="st">"rasterpolygonizer"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="va">filename</span>, package <span class="op">=</span> <span class="va">pkg</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">path</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"File '%s' not found in inst/extdata"</span>, <span class="va">filename</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">path</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu">load_extdata</span><span class="op">(</span><span class="st">"sample_raster.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu">load_extdata</span><span class="op">(</span><span class="st">"sample_buildings.gpkg"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The sample dataset covers a small area of Fairbanks, Alaska.
<code>r</code> is a LiDAR-derived digital surface model (DSM) — a raster
where each cell records the elevation of the highest surface at that
location, whether bare earth, a rooftop, or a tree. <code>b</code>
contains manually digitized building footprints used later as a
validation reference.</p>
<hr>
</div>
<div class="section level3">
<h3 id="a-shared-plot-theme">A Shared Plot Theme<a class="anchor" aria-label="anchor" href="#a-shared-plot-theme"></a>
</h3>
<p>To keep figures consistent throughout the vignette, we define a
shared ggplot theme and color scale built around earth tones — the
natural palette of terrain and built surfaces in LiDAR data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theme_rp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      plot.background   <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f5f0e8"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      panel.background  <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f5f0e8"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      panel.grid        <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#ddd5c0"</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>      plot.title        <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, color <span class="op">=</span> <span class="st">"#3b2f1e"</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>      plot.subtitle     <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#6b5740"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#f5f0e8"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>      legend.title      <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#3b2f1e"</span>, size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>      legend.text       <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#3b2f1e"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>      axis.text         <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#6b5740"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">scale_fill_rp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>    colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#4a3728"</span>, <span class="st">"#7a5c3e"</span>, <span class="st">"#b08a5a"</span>, <span class="st">"#d4b483"</span>, <span class="st">"#e8d5a3"</span>, <span class="st">"#f0e8c8"</span><span class="op">)</span>,</span>
<span>    <span class="va">...</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="step-1-fill-the-ground-raster">Step 1 — Fill the Ground Raster<a class="anchor" aria-label="anchor" href="#step-1-fill-the-ground-raster"></a>
</h3>
<p><strong><code>fill_ground_raster(raster)</code></strong></p>
<p>LiDAR point clouds frequently contain data voids — areas where the
sensor received no usable return, often under dense vegetation, at steep
angles, or near flight strip edges. Left unfilled, these holes create
discontinuities that interrupt edge detection downstream. This function
applies spatial interpolation to fill NA cells and produce a continuous
elevation surface. No tunable parameters are exposed; run it as-is
before any other step.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_df_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">r</span>, xy <span class="op">=</span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r_df_raw</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">r_df_raw</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_rp</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elev. (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_rp</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Raw Input Raster"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"LiDAR digital surface model — voids appear where returns were absent or filtered"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="raster-polygonizer-workflow_files/figure-html/fill-1.png" class="r-plt" alt="" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_filled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fill_ground_raster.html">fill_ground_raster</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_df_filled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">r_filled</span>, xy <span class="op">=</span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r_df_filled</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">r_df_filled</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_rp</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elev. (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_rp</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Filled Ground Raster"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Voids have been interpolated — the surface is now continuous"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="raster-polygonizer-workflow_files/figure-html/fill-2.png" class="r-plt" alt="" width="672" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level3">
<h3 id="step-2-extract-building-edge-polygons">Step 2 — Extract Building Edge Polygons<a class="anchor" aria-label="anchor" href="#step-2-extract-building-edge-polygons"></a>
</h3>
<p><strong><code>extract_building_edges_to_polygons(raster, thr_prob)</code></strong></p>
<p>Buildings appear in a DSM as abrupt vertical discontinuities — places
where elevation jumps sharply from ground level to rooftop height. This
function detects those elevation gradients, traces their outlines, and
assembles the resulting edge pixels into closed polygons.</p>
<p><strong>Key parameter — <code>thr_prob</code></strong> (default
<code>0.8</code>): The probability threshold controlling which pixels
are classified as building edges. Higher values are more conservative,
retaining only the sharpest and most obvious edges. For scenes with many
small or tightly-packed buildings, a higher <code>thr_prob</code>
reduces false detections from vegetation and clutter. For sparse or
large buildings where you want more complete outlines, a lower value
recovers more edge detail.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edges</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_building_edges_to_polygons.html">extract_building_edges_to_polygons</a></span><span class="op">(</span><span class="va">r_filled</span>, thr_prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="step-3-clean-building-polygons">Step 3 — Clean Building Polygons<a class="anchor" aria-label="anchor" href="#step-3-clean-building-polygons"></a>
</h3>
<p><strong><code>clean_building_polygons(closed_edges, shrink_dist, simplify_tol, min_area, max_area)</code></strong></p>
<p>Raw edge polygons tend to be jagged and oversized — edge detection
traces the outer perimeter of the gradient band, which sits just outside
the true rooftop boundary. This function applies three successive
cleaning operations.</p>
<p><strong><code>shrink_dist</code></strong> (negative value,
e.g. <code>-0.5</code>): Pulls polygon edges inward by this distance in
map units, compensating for the outward bias of edge detection. Use a
more negative value when your raster has coarser resolution or when
building walls are thick relative to cell size.</p>
<p><strong><code>simplify_tol</code></strong> (e.g. <code>2.5</code>):
Douglas-Peucker simplification tolerance. Smooths jagged outlines
without losing the overall footprint shape. Larger values produce
simpler, blockier polygons.</p>
<p><strong><code>min_area</code> / <code>max_area</code></strong>:
Polygons outside this size range are dropped. Set <code>min_area</code>
to exclude noise patches and small vegetation clumps; set
<code>max_area</code> to exclude large merged regions unlikely to
represent individual buildings.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_building_polygons.html">clean_building_polygons</a></span><span class="op">(</span></span>
<span>  closed_edges <span class="op">=</span> <span class="va">edges</span><span class="op">$</span><span class="va">closed_edges</span>,</span>
<span>  shrink_dist  <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,</span>
<span>  simplify_tol <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  min_area     <span class="op">=</span> <span class="fl">19.99</span>,</span>
<span>  max_area     <span class="op">=</span> <span class="fl">3000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">r_filled</span>, xy <span class="op">=</span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r_df</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">r_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">buildings_sf</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"#8b2500"</span>, linewidth <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_rp</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elev. (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_rp</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Candidate Building Polygons"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Cleaned and size-filtered — outlines shown over the filled raster"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="raster-polygonizer-workflow_files/figure-html/clean-1.png" class="r-plt" alt="" width="672" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level3">
<h3 id="step-4-filter-by-ground-truth">Step 4 — Filter by Ground Truth<a class="anchor" aria-label="anchor" href="#step-4-filter-by-ground-truth"></a>
</h3>
<p><strong><code>filter_by_ground_truth(buildings, reference, threshold)</code></strong></p>
<p>Not every candidate polygon corresponds to a real building — some may
be vegetation, elevated infrastructure, or detection artifacts. When a
reference layer of known building footprints is available (e.g., from
municipal records or manual digitizing), this function uses spatial
overlap to keep only the detections that match a reference polygon. If
no reference layer is available, skip this step.</p>
<p><strong>Key parameter — <code>threshold</code></strong> (default
<code>0.5</code>): The minimum fractional overlap
(intersection-over-union) required to accept a candidate as a true
detection. A value of <code>0.5</code> requires at least 50% area
overlap with a reference polygon. Lower this to recover partial matches;
raise it to require tighter geometric agreement.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign a CRS to align all layers (UTM Zone 6N for Fairbanks, AK)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>        <span class="op">&lt;-</span> <span class="st">"EPSG:32606"</span></span>
<span><span class="va">r_crs</span>                <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">r_filled</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">r_crs</span></span>
<span><span class="va">buildings_sf</span>         <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="va">buildings_sf</span>, <span class="va">r_crs</span><span class="op">)</span></span>
<span><span class="va">b</span>                    <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="va">b</span>, <span class="va">r_crs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_by_ground_truth.html">filter_by_ground_truth</a></span><span class="op">(</span></span>
<span>  <span class="va">buildings_sf</span>,</span>
<span>  <span class="va">b</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">r_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">filtered</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"#8b2500"</span>, linewidth <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_rp</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elev. (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_rp</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"After Ground Truth Filtering"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Only polygons with sufficient overlap with reference footprints are retained"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="raster-polygonizer-workflow_files/figure-html/filter-1.png" class="r-plt" alt="" width="672" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level3">
<h3 id="step-5-remove-invalid-polygons">Step 5 — Remove Invalid Polygons<a class="anchor" aria-label="anchor" href="#step-5-remove-invalid-polygons"></a>
</h3>
<p><strong><code>remove_invalid_polys(buildings, raster)</code></strong></p>
<p>Even after size and overlap filtering, some polygons may fall in
areas of the raster too sparse to support reliable analysis — at flight
strip edges, or where interpolation could not produce a reliable
surface. This function checks raster coverage within each polygon and
removes those that fall below an acceptable data density. It is a final
data quality gate, requires no parameters, and should always be run
before the characterization steps.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valid_polys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/remove_invalid_polys.html">remove_invalid_polys</a></span><span class="op">(</span><span class="va">filtered</span>, <span class="va">r_filled</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">r_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">valid_polys</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"#8b2500"</span>, linewidth <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_rp</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elev. (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_rp</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Validated Building Polygons"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Polygons with insufficient raster coverage have been removed"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="raster-polygonizer-workflow_files/figure-html/remove-invalid-1.png" class="r-plt" alt="" width="672" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level3">
<h3 id="step-6a-estimate-building-height">Step 6a — Estimate Building Height<a class="anchor" aria-label="anchor" href="#step-6a-estimate-building-height"></a>
</h3>
<p><strong><code>estimate_building_height(buildings, raster)</code></strong></p>
<p>This function extracts the mean elevation of the raster cells within
each polygon. In a normalized DSM (where ground elevation has already
been subtracted), this value is building height directly. In a raw DSM,
it represents absolute rooftop elevation — useful for differencing
against a pre-snow scan to derive snow depth. No tunable parameters are
required.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_building_height.html">estimate_building_height</a></span><span class="op">(</span><span class="va">valid_polys</span>, <span class="va">r_filled</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  digits  <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Estimated mean rooftop elevation for the first 10 buildings (meters)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Estimated mean rooftop elevation for the first 10 buildings
(meters)</caption>
<colgroup>
<col width="2%">
<col width="27%">
<col width="10%">
<col width="7%">
<col width="5%">
<col width="15%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">geometry</th>
<th align="right">building_id</th>
<th align="right">area</th>
<th align="right">perim</th>
<th align="right">perim_area_ratio</th>
<th align="right">vertices</th>
<th align="right">inside_q</th>
<th align="right">outside_q</th>
<th align="right">height</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">3</td>
<td align="left">POLYGON ((465880.9 7193013,…</td>
<td align="right">3</td>
<td align="right">46.71</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">152.32</td>
<td align="right">145.34</td>
<td align="right">6.97</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">POLYGON ((465784.9 7193026,…</td>
<td align="right">4</td>
<td align="right">56.52</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">149.50</td>
<td align="right">144.93</td>
<td align="right">4.57</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">POLYGON ((465886.5 7193048,…</td>
<td align="right">5</td>
<td align="right">221.00</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">151.92</td>
<td align="right">145.18</td>
<td align="right">6.74</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">POLYGON ((465708.5 7193102,…</td>
<td align="right">6</td>
<td align="right">2326.31</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">9</td>
<td align="right">155.17</td>
<td align="right">145.10</td>
<td align="right">10.08</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="left">POLYGON ((465757.5 7193110,…</td>
<td align="right">7</td>
<td align="right">179.47</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">7</td>
<td align="right">149.44</td>
<td align="right">145.21</td>
<td align="right">4.23</td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="left">POLYGON ((465884.5 7193135,…</td>
<td align="right">9</td>
<td align="right">1104.02</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">7</td>
<td align="right">153.41</td>
<td align="right">145.68</td>
<td align="right">7.73</td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="left">POLYGON ((465728.5 7193238,…</td>
<td align="right">10</td>
<td align="right">681.50</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">151.50</td>
<td align="right">144.83</td>
<td align="right">6.67</td>
</tr>
<tr class="even">
<td align="left">12</td>
<td align="left">POLYGON ((465919.5 7193279,…</td>
<td align="right">12</td>
<td align="right">934.96</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">154.38</td>
<td align="right">144.96</td>
<td align="right">9.42</td>
</tr>
<tr class="odd">
<td align="left">13</td>
<td align="left">POLYGON ((465809.5 7193281,…</td>
<td align="right">13</td>
<td align="right">927.37</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">154.36</td>
<td align="right">144.85</td>
<td align="right">9.51</td>
</tr>
<tr class="even">
<td align="left">14</td>
<td align="left">POLYGON ((465770.5 7193332,…</td>
<td align="right">14</td>
<td align="right">938.50</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">154.42</td>
<td align="right">144.88</td>
<td align="right">9.55</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level3">
<h3 id="step-6b-roof-slope-and-aspect-via-ransac">Step 6b — Roof Slope and Aspect via RANSAC<a class="anchor" aria-label="anchor" href="#step-6b-roof-slope-and-aspect-via-ransac"></a>
</h3>
<p><strong><code>roof_slope_RANSAC(raster, buildings, n_iter, thresh, min_inliers)</code></strong></p>
<p>Roof slope and orientation (aspect) are key determinants of snow
retention — a steep south-facing roof sheds snow quickly, while a
shallow north-facing roof may accumulate loads several times greater.
This function fits a plane to the raster elevation values within each
polygon using RANSAC (Random Sample Consensus), a robust estimation
method that tolerates outlier pixels caused by dormers, vents, parapets,
and sensor noise.</p>
<p>For each building, the algorithm randomly samples 3-point subsets,
fits a plane, and counts how many of the remaining pixels (inliers) fall
within a residual threshold. The plane with the most inliers wins. A
stability metric — the spread of slope values across the top 5% of
candidate fits — is also returned to flag geometrically ambiguous or
noisy roofs.</p>
<p><strong><code>n_iter</code></strong> (default <code>500</code>):
Number of random plane candidates evaluated. More iterations improve
robustness at the cost of computation time. For large datasets
<code>200</code> is often sufficient; for noisy or complex roofs,
<code>1000</code> or more may help.</p>
<p><strong><code>thresh</code></strong> (default <code>0.1</code>):
Residual distance in elevation units within which a pixel counts as an
inlier. Tighten this for high-quality, dense LiDAR where you expect a
clean planar surface. Loosen it for coarser or noisier data where pixel
scatter is inherently higher.</p>
<p><strong><code>min_inliers</code></strong> (default <code>10</code>):
Minimum inlier pixels required to accept a plane fit. For small
buildings with few raster cells, lower this value to avoid discarding
valid detections. For large buildings, raising it ensures the fitted
plane is well-supported by data.</p>
<p><strong>Interpreting <code>slope_spread</code>:</strong> A low value
(near 0) means the top candidate planes agreed closely on slope — the
roof is likely a clean, simple plane. A high value suggests complex
geometry or noisy data; treat that building’s slope estimate with added
caution.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings_sv</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">valid_polys</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"building_id"</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">buildings_sv</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">buildings_sv</span><span class="op">$</span><span class="va">building_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">buildings_sv</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ransac_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/roof_slope_RANSAC.html">roof_slope_RANSAC</a></span><span class="op">(</span></span>
<span>  raster      <span class="op">=</span> <span class="va">r_filled</span>,</span>
<span>  buildings   <span class="op">=</span> <span class="va">buildings_sv</span>,</span>
<span>  n_iter      <span class="op">=</span> <span class="fl">500L</span>,</span>
<span>  thresh      <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  min_inliers <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>  quiet       <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ransac_result</span><span class="op">$</span><span class="va">summary_table</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  digits  <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Roof slope and aspect estimates for the first 10 buildings"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Roof slope and aspect estimates for the first 10
buildings</caption>
<colgroup>
<col width="15%">
<col width="13%">
<col width="14%">
<col width="13%">
<col width="17%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th align="right">building_id</th>
<th align="right">slope_deg</th>
<th align="right">aspect_deg</th>
<th align="right">n_inliers</th>
<th align="right">slope_spread</th>
<th align="right">top_5_percent_count</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="right">17.42</td>
<td align="right">94.35</td>
<td align="right">25</td>
<td align="right">2.42</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2.89</td>
<td align="right">173.89</td>
<td align="right">38</td>
<td align="right">1.65</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">5.01</td>
<td align="right">180.61</td>
<td align="right">234</td>
<td align="right">0.56</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.41</td>
<td align="right">203.25</td>
<td align="right">2134</td>
<td align="right">0.21</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0.12</td>
<td align="right">336.99</td>
<td align="right">218</td>
<td align="right">0.24</td>
<td align="right">21</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">0.50</td>
<td align="right">292.62</td>
<td align="right">744</td>
<td align="right">0.49</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">0.35</td>
<td align="right">1.47</td>
<td align="right">694</td>
<td align="right">0.42</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">0.05</td>
<td align="right">227.97</td>
<td align="right">964</td>
<td align="right">0.26</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="right">0.18</td>
<td align="right">267.57</td>
<td align="right">932</td>
<td align="right">0.31</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="right">14</td>
<td align="right">1.33</td>
<td align="right">90.90</td>
<td align="right">911</td>
<td align="right">0.28</td>
<td align="right">25</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level3">
<h3 id="whats-next">What’s Next?<a class="anchor" aria-label="anchor" href="#whats-next"></a>
</h3>
<p>With per-building height, slope, and aspect values in hand, the
natural next steps are:</p>
<ul>
<li>
<strong>Snow load estimation</strong> — difference two DSMs (pre-
and post-snowfall) within each validated polygon to derive snow depth,
then combine with slope to estimate structural load</li>
<li>
<strong>Spatial aggregation</strong> — summarize risk metrics by
neighborhood, building type, or construction era</li>
<li>
<strong>Validation</strong> — compare derived slope values against
as-built drawings or field measurements to quantify method accuracy</li>
</ul>
<p>All outputs are standard R objects — <code>sf</code> data frames and
<code>terra</code> rasters — and can be written to disk with
<code><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">sf::st_write()</a></code> and <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">terra::writeRaster()</a></code>
respectively.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jashon Newlun.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
