<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Raster Polygonizer Workflow • rasterpolygonizer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Raster Polygonizer Workflow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rasterpolygonizer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/raster-polygonizer-workflow.html">Raster Polygonizer Workflow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Raster Polygonizer Workflow</h1>
            
      

      <div class="hidden name"><code>raster-polygonizer-workflow.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="from-lidar-scan-to-building-footprint">From LiDAR Scan to Building Footprint<a class="anchor" aria-label="anchor" href="#from-lidar-scan-to-building-footprint"></a>
</h2>
<p><em>A complete workflow for extracting, filtering, and characterizing
rooftop polygons from aerial elevation data</em></p>
<hr>
<div class="section level3">
<h3 id="why-this-package">Why This Package?<a class="anchor" aria-label="anchor" href="#why-this-package"></a>
</h3>
<p>Heavy snow accumulation on rooftops is a serious safety concern in
cold climates — when loads grow too large, roofs can fail
catastrophically. Understanding and predicting this risk requires
detailed information about building geometry across entire cities, but
traditional manual surveys are slow, expensive, and limited in
scale.</p>
<p>Airborne LiDAR (Light Detection and Ranging) offers a powerful
alternative. By bouncing laser pulses off surfaces from an aircraft and
recording the return time, LiDAR produces dense, precise
three-dimensional maps of the built environment. Comparing scans taken
before and after a snowfall event makes it possible to measure rooftop
snow accumulation automatically — at city scale, for thousands of
buildings at once.</p>
<p><code>rasterpolygonizer</code> packages the full processing chain
needed to go from a raw LiDAR-derived elevation raster to a clean,
attributed set of building footprints, ready for snow load analysis,
engineering assessment, or any other rooftop-scale application.</p>
<hr>
</div>
<div class="section level3">
<h3 id="workflow-overview">Workflow Overview<a class="anchor" aria-label="anchor" href="#workflow-overview"></a>
</h3>
<p>The six functions in this package form a linear pipeline. Each step
produces output consumed by the next:</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="40%">
<col width="36%">
</colgroup>
<thead><tr class="header">
<th align="center">Step</th>
<th>Function</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td><code><a href="../reference/fill_ground_raster.html">fill_ground_raster()</a></code></td>
<td>Fill voids using clustering-based ground estimation</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td><code><a href="../reference/extract_building_edges_to_polygons.html">extract_building_edges_to_polygons()</a></code></td>
<td>Detect edges via Sobel gradients and close them morphologically</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td><code><a href="../reference/clean_building_polygons.html">clean_building_polygons()</a></code></td>
<td>Polygonize enclosed interiors, then shrink, simplify, and filter by
area</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td><code><a href="../reference/filter_by_ground_truth.html">filter_by_ground_truth()</a></code></td>
<td>Retain candidates with sufficient containment within reference
footprints</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td><code><a href="../reference/remove_invalid_polys.html">remove_invalid_polys()</a></code></td>
<td>Remove ground-contaminated and nested polygons</td>
</tr>
<tr class="even">
<td align="center">6a</td>
<td><code><a href="../reference/estimate_building_height.html">estimate_building_height()</a></code></td>
<td>Estimate height relative to surrounding ground elevation</td>
</tr>
<tr class="odd">
<td align="center">6b</td>
<td><code><a href="../reference/roof_slope_RANSAC.html">roof_slope_RANSAC()</a></code></td>
<td>Fit robust planes and derive slope and aspect per roof</td>
</tr>
</tbody>
</table>
<p>Steps 6a and 6b are independent characterization steps — run either
or both depending on your analysis goals.</p>
<hr>
</div>
<div class="section level3">
<h3 id="load-example-data">Load Example Data<a class="anchor" aria-label="anchor" href="#load-example-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">load_extdata</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">filename</span>, <span class="va">pkg</span> <span class="op">=</span> <span class="st">"rasterpolygonizer"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="va">filename</span>, package <span class="op">=</span> <span class="va">pkg</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">path</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"File '%s' not found in inst/extdata"</span>, <span class="va">filename</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">path</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu">load_extdata</span><span class="op">(</span><span class="st">"sample_raster.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu">load_extdata</span><span class="op">(</span><span class="st">"sample_buildings.gpkg"</span><span class="op">)</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The sample dataset covers a small area of Fairbanks, Alaska.
<code>r</code> is a LiDAR-derived digital surface model (DSM) — a raster
where each cell records the elevation of the highest surface at that
location, whether bare earth, a rooftop, or a tree. <code>b</code>
contains digitized building footprints provided by the Fairbanks North
Star Borough.</p>
<hr>
<p>#We define a shared ggplot theme using a warm earth-tone document
background, and a blue-to-gold raster fill palette. Blue and gold sit
across from each other on the color wheel — the cool-to-warm contrast
gives elevation data strong visual pop against the neutral document
background while remaining readable in print.</p>
</div>
<div class="section level3">
<h3 id="step-1-fill-the-ground-raster">Step 1 — Fill the Ground Raster<a class="anchor" aria-label="anchor" href="#step-1-fill-the-ground-raster"></a>
</h3>
<p><strong><code>fill_ground_raster(raster, w = 15)</code></strong></p>
<p>LiDAR point clouds frequently contain data voids where the sensor
received no usable return, typically due to occlusion between the
collection device and the point of measurement. Left unfilled, these
holes disrupt the gradient computation in Step 2.</p>
<p><code><a href="../reference/fill_ground_raster.html">fill_ground_raster()</a></code> addresses this with a focal
neighborhood approach designed specifically for elevation data. For each
NA cell, it examines all valid neighbors within a <code>w × w</code>
window and uses k-means clustering (up to 3 clusters) to separate them
by elevation. It then returns the median of the <em>lowest</em> cluster
— the best available estimate of ground level at that location. This
means the fill preferentially recovers ground-level values rather than
being pulled upward by nearby rooftops or vegetation, which is exactly
what downstream processing needs.</p>
<p><strong><code>w</code></strong> (default <code>15</code>): The focal
window size in pixels. Larger windows can fill bigger voids but may pull
values from more distant and less representative neighbors. Typically
this window size will work well unless the buildings of interest are
very large.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_df_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">r</span>, xy <span class="op">=</span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r_df_raw</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">r_df_raw</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_rp</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elev. (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_rp</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Raw Input Raster"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"LiDAR digital surface model — voids appear where returns were absent or filtered"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="raster-polygonizer-workflow_files/figure-html/fill-1.png" class="r-plt" alt="" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_filled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fill_ground_raster.html">fill_ground_raster</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_df_filled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">r_filled</span>, xy <span class="op">=</span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r_df_filled</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">r_df_filled</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_rp</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elev. (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_rp</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Filled Ground Raster"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Voids filled using clustering-based ground estimation"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="raster-polygonizer-workflow_files/figure-html/fill-2.png" class="r-plt" alt="" width="70%" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level3">
<h3 id="step-2-extract-building-edge-polygons">Step 2 — Extract Building Edge Polygons<a class="anchor" aria-label="anchor" href="#step-2-extract-building-edge-polygons"></a>
</h3>
<p><strong><code>extract_building_edges_to_polygons(raster, smooth_w, thr_prob, morph_w)</code></strong></p>
<p>Buildings appear in a DSM as abrupt vertical discontinuities — sharp
jumps in elevation from ground to rooftop. This function detects those
discontinuities through a four-stage image processing pipeline:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Smoothing</strong> — a mean focal filter reduces sensor
noise before gradient computation</li>
<li>
<strong>Sobel gradient</strong> — horizontal (Gx) and vertical (Gy)
Sobel kernels are applied to the smoothed raster, and their combined
magnitude (<code>sqrt(Gx² + Gy²)</code>) captures edge strength in all
directions</li>
<li>
<strong>Thresholding</strong> — pixels whose gradient magnitude
exceeds the <code>thr_prob</code> quantile of all gradient values are
classified as edges</li>
<li>
<strong>Morphological closing</strong> — a expand-then-erode
operation bridges small gaps in the detected edge lines, producing
closed loops that surround building interiors</li>
</ol>
<p><strong><code>thr_prob</code></strong> (default <code>0.70</code>):
The quantile threshold applied to gradient magnitude. At
<code>0.70</code>, the top 30% of gradient values are classified as
edges. <em>Raising this value makes the detector more selective</em> —
only the strongest gradients (sharpest elevation transitions) pass
through, which helps in dense urban scenes with many small buildings
where vegetation and clutter produce weaker false edges. Lowering it
recovers subtler edges but increases noise.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edges</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_building_edges_to_polygons.html">extract_building_edges_to_polygons</a></span><span class="op">(</span><span class="va">r_filled</span>, thr_prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="step-3-clean-building-polygons">Step 3 — Clean Building Polygons<a class="anchor" aria-label="anchor" href="#step-3-clean-building-polygons"></a>
</h3>
<p><strong><code>clean_building_polygons(closed_edges, shrink_dist, simplify_tol, min_area, max_area)</code></strong></p>
<p>The closed edge loops from Step 2 define the <em>perimeters</em> of
buildings, but what we actually need are filled polygon footprints. The
key insight in this function is that the edge loops enclose interior
regions — so the function first <em>inverts</em> the edge raster and
polygonizes the enclosed FALSE (interior) regions. Those interiors are
the building footprints.</p>
<p>After polygonization, three cleaning operations are applied in
sequence:</p>
<p><strong><code>shrink_dist</code></strong> (default <code>-0.5</code>,
map units): A negative buffer shrinks each polygon inward. This is
necessary because the edge band detected in Step 2 sits slightly outside
the true rooftop boundary — the shrink compensates for that outward
bias. Use a more negative value for coarser-resolution rasters where the
edge band is wider.</p>
<p><strong><code>simplify_tol</code></strong> (default <code>0.5</code>,
map units): Douglas-Peucker simplification removes redundant vertices
and smooths jagged outlines without distorting the overall footprint
shape. Larger values produce cleaner but blockier polygons.</p>
<p><strong><code>min_area</code> / <code>max_area</code></strong>: After
exploding all multi-part geometries into individual polygons, those
outside this size range are dropped. <code>min_area</code> removes noise
patches and the small gaps between edge pixels; <code>max_area</code>
removes the large background region (the inverted raster always produces
one polygon covering everything <em>outside</em> the buildings, which is
discarded here).</p>
<p>The function also computes and attaches <code>area</code>,
<code>perimeter</code>, <code>perim_area_ratio</code>, and
<code>vertices</code> columns to the output for downstream use.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_building_polygons.html">clean_building_polygons</a></span><span class="op">(</span></span>
<span>  closed_edges <span class="op">=</span> <span class="va">edges</span><span class="op">$</span><span class="va">closed_edges</span>,</span>
<span>  shrink_dist  <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>,</span>
<span>  simplify_tol <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  min_area     <span class="op">=</span> <span class="fl">19.99</span>,</span>
<span>  max_area     <span class="op">=</span> <span class="fl">3000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">r_filled</span>, xy <span class="op">=</span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r_df</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"value"</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">r_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">buildings_sf</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"#c47c0f"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_rp</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elev. (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_rp</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Candidate Building Polygons"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Interior regions enclosed by edge loops, shrunk and simplified"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="raster-polygonizer-workflow_files/figure-html/clean-1.png" class="r-plt" alt="" width="70%" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level3">
<h3 id="step-4-filter-by-ground-truth">Step 4 — Filter by Ground Truth<a class="anchor" aria-label="anchor" href="#step-4-filter-by-ground-truth"></a>
</h3>
<p><strong><code>filter_by_ground_truth(candidates, truth, threshold = 0.75)</code></strong></p>
<p>Not every candidate polygon corresponds to a real building — some
will be vegetation clumps, elevated infrastructure, or detection
artifacts. When a reference layer of known building footprints is
available (e.g., from municipal GIS records or manual digitizing), this
function uses spatial overlap to filter out false detections.</p>
<p>For each candidate polygon, the function computes a
<strong>containment ratio</strong>: the area of intersection with any
overlapping reference polygon divided by the total area of the
candidate. If this ratio meets or exceeds <code>threshold</code>, the
candidate is kept. A ratio of <code>0.75</code> means that at least 75%
of the detected polygon’s area must fall inside a reference
footprint.</p>
<p>Note that this is a one-sided measure — it evaluates how well the
<em>candidate</em> is contained within the reference, not the reverse.
This means a smaller detected polygon that sits neatly inside a large
reference footprint will pass, while a candidate that extends
significantly beyond the reference boundary will be rejected.</p>
<blockquote>
<p><strong>No reference layer available?</strong> Skip this step and
proceed directly to Step 5. The function is optional in the
pipeline.</p>
</blockquote>
<p><strong><code>threshold</code></strong> (default <code>0.75</code>):
Lower values recover more partial matches at the cost of accepting more
false detections; higher values demand tighter spatial agreement with
the reference.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign a CRS to align all layers (UTM Zone 6N for Fairbanks, AK)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>        <span class="op">&lt;-</span> <span class="st">"EPSG:32606"</span></span>
<span><span class="va">r_crs</span>                <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">r_filled</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">r_crs</span></span>
<span><span class="va">buildings_sf</span>         <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="va">buildings_sf</span>, <span class="va">r_crs</span><span class="op">)</span></span>
<span><span class="va">b</span>                    <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="va">b</span>, <span class="va">r_crs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_by_ground_truth.html">filter_by_ground_truth</a></span><span class="op">(</span></span>
<span>  <span class="va">buildings_sf</span>,</span>
<span>  <span class="va">b</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.75</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">r_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">filtered</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"#c47c0f"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_rp</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elev. (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_rp</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"After Ground Truth Filtering"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Candidates retained where ≥50% of their area overlaps a reference footprint"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="raster-polygonizer-workflow_files/figure-html/filter-1.png" class="r-plt" alt="" width="70%" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level3">
<h3 id="step-5-remove-invalid-polygons">Step 5 — Remove Invalid Polygons<a class="anchor" aria-label="anchor" href="#step-5-remove-invalid-polygons"></a>
</h3>
<p><strong><code>remove_invalid_polys(polys, raster, buffer_dist, ground_tol, remove_nested)</code></strong></p>
<p>This function performs two distinct cleanup passes in a deliberate
order.</p>
<p><strong>Pass 1 — Ground contamination check:</strong> For each
polygon, the function extracts the minimum elevation value inside the
polygon and the minimum elevation value in a surrounding buffer ring of
width <code>buffer_dist</code>. If the absolute difference between these
two minima is less than <code>ground_tol</code>, the polygon is flagged
as ground-contaminated and removed. The logic is straightforward: a
polygon sitting on an actual rooftop should have notably higher minimum
elevations than the ground immediately surrounding it. If the inside and
outside minima are nearly the same, the polygon is likely sitting on
flat ground rather than a raised surface.</p>
<p><strong>Pass 2 — Nested polygon removal:</strong> After ground
filtering, any polygon that is fully spatially contained within another
polygon is removed. This handles cases where the edge detection and
polygonization steps produce concentric outlines around the same
building. Ground-contaminated polygons are removed <em>before</em> this
step intentionally — otherwise, a large invalid polygon could cause
valid smaller polygons nested within it to be incorrectly discarded.</p>
<p><strong><code>ground_tol</code></strong> (default <code>3</code>, map
units): The minimum elevation difference required between inside and
outside minima to consider a polygon a valid raised structure. Increase
this in flat terrain where small elevation differences are common noise;
decrease it where rooftop-to-ground relief is reliably large.</p>
<p><strong><code>buffer_dist</code></strong> (default <code>5</code>,
map units): Width of the exterior ring used for the ground comparison.
Should be wide enough to capture true ground-level values beyond the
building footprint, but not so wide that it picks up adjacent
buildings.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">valid_polys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/remove_invalid_polys.html">remove_invalid_polys</a></span><span class="op">(</span><span class="va">filtered</span>, <span class="va">r_filled</span>, ground_tol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">r_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">valid_polys</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"#c47c0f"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_rp</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Elev. (m)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_rp</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title    <span class="op">=</span> <span class="st">"Validated Building Polygons"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Ground-contaminated and nested polygons removed"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="raster-polygonizer-workflow_files/figure-html/remove-invalid-1.png" class="r-plt" alt="" width="70%" style="display: block; margin: auto;"></p>
<hr>
</div>
<div class="section level3">
<h3 id="step-6a-estimate-building-height">Step 6a — Estimate Building Height<a class="anchor" aria-label="anchor" href="#step-6a-estimate-building-height"></a>
</h3>
<p><strong><code>estimate_building_height(polys, raster, buffer_dist, prob, clamp)</code></strong></p>
<p>Rather than simply averaging elevation values inside a polygon (which
would give absolute rooftop elevation, not building height), this
function estimates height <em>relative to the surrounding ground</em>.
For each polygon it computes a low percentile of raster values inside
the polygon (<code>inside_q</code>) and the same percentile in a
surrounding buffer ring (<code>outside_q</code>). Height is then
<code>inside_q - outside_q</code>.</p>
<p>Using a low percentile (default <code>prob = 0.02</code>, the 2nd
percentile) rather than the minimum makes the estimate robust to rooftop
features like dips or holes. The same percentile is used for both inside
and outside values for consistency. If <code>clamp = TRUE</code>,
negative heights (which can arise from noisy data or polygon edge
effects) are set to zero. Using as low a value as possible inside our
interior polygon will help to combat bias towards the peak of gabled
roofs.</p>
<p>The function returns the input polygon layer with three new columns:
<code>inside_q</code>, <code>outside_q</code>, and
<code>height</code>.</p>
<p><strong><code>buffer_dist</code></strong> (default <code>5</code>,
map units): Width of the exterior ring used to sample surrounding ground
elevation. Should extend far enough to clear the building footprint and
capture true ground values.</p>
<p><strong><code>prob</code></strong> (default <code>0.02</code>):
Quantile used for both inside and outside elevation estimates. Lower
values are more robust to high-elevation outliers but may be sensitive
to data voids if coverage is thin.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_building_height.html">estimate_building_height</a></span><span class="op">(</span><span class="va">valid_polys</span>, <span class="va">r_filled</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"building_id"</span>, <span class="st">"inside_q"</span>, <span class="st">"outside_q"</span>, <span class="st">"height"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  digits  <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Estimated building height for the first 10 polygons. Height is the difference between the 2nd-percentile rooftop elevation and the 2nd-percentile ground elevation in the surrounding buffer ring."</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Estimated building height for the first 10 polygons. Height is
the difference between the 2nd-percentile rooftop elevation and the
2nd-percentile ground elevation in the surrounding buffer
ring.</caption>
<colgroup>
<col width="4%">
<col width="16%">
<col width="12%">
<col width="13%">
<col width="9%">
<col width="43%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">building_id</th>
<th align="right">inside_q</th>
<th align="right">outside_q</th>
<th align="right">height</th>
<th align="left">geometry</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2</td>
<td align="right">2</td>
<td align="right">148.39</td>
<td align="right">144.86</td>
<td align="right">3.53</td>
<td align="left">POLYGON ((465812.5 7193007,…</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="right">6</td>
<td align="right">149.41</td>
<td align="right">144.94</td>
<td align="right">4.47</td>
<td align="left">POLYGON ((465779.9 7193021,…</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="right">7</td>
<td align="right">155.18</td>
<td align="right">145.30</td>
<td align="right">9.88</td>
<td align="left">POLYGON ((465709.5 7193102,…</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="right">8</td>
<td align="right">149.44</td>
<td align="right">145.30</td>
<td align="right">4.14</td>
<td align="left">POLYGON ((465758.5 7193108,…</td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="right">10</td>
<td align="right">151.50</td>
<td align="right">144.88</td>
<td align="right">6.62</td>
<td align="left">POLYGON ((465729.9 7193238,…</td>
</tr>
<tr class="even">
<td align="left">11</td>
<td align="right">11</td>
<td align="right">154.36</td>
<td align="right">144.86</td>
<td align="right">9.50</td>
<td align="left">POLYGON ((465798.5 7193214,…</td>
</tr>
<tr class="odd">
<td align="left">13</td>
<td align="right">13</td>
<td align="right">154.43</td>
<td align="right">144.90</td>
<td align="right">9.52</td>
<td align="left">POLYGON ((465757.9 7193331,…</td>
</tr>
<tr class="even">
<td align="left">15</td>
<td align="right">15</td>
<td align="right">154.34</td>
<td align="right">144.91</td>
<td align="right">9.42</td>
<td align="left">POLYGON ((465807.5 7193300,…</td>
</tr>
<tr class="odd">
<td align="left">37</td>
<td align="right">37</td>
<td align="right">152.01</td>
<td align="right">145.23</td>
<td align="right">6.78</td>
<td align="left">POLYGON ((465887.5 7193048,…</td>
</tr>
<tr class="even">
<td align="left">41</td>
<td align="right">41</td>
<td align="right">150.10</td>
<td align="right">145.65</td>
<td align="right">4.45</td>
<td align="left">POLYGON ((465854.5 7193103,…</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level3">
<h3 id="step-6b-roof-slope-and-aspect-via-ransac">Step 6b — Roof Slope and Aspect via RANSAC<a class="anchor" aria-label="anchor" href="#step-6b-roof-slope-and-aspect-via-ransac"></a>
</h3>
<p><strong><code>roof_slope_RANSAC(raster, buildings, n_iter, thresh, min_inliers)</code></strong></p>
<p>Roof slope and orientation (aspect) are key determinants of snow
retention — a steep south-facing roof sheds snow quickly, while a
shallow north-facing roof may accumulate loads several times greater.
This function fits a plane to the raster elevation values within each
polygon using RANSAC (Random Sample Consensus), a robust estimation
method that explicitly tolerates outlier pixels caused by dormers,
vents, parapets, and sensor noise.</p>
<p>Each RANSAC iteration randomly draws 3 pixels from the building’s
raster footprint, fits a plane through them via linear regression
(<code>z ~ x + y</code>), and counts how many of the <em>remaining</em>
pixels have residuals below <code>thresh</code> (inliers). After
<code>n_iter</code> iterations, the plane that maximized inlier count is
selected and used to compute final slope and aspect:</p>
<ul>
<li>
<strong>Slope</strong> = <code>atan(sqrt(a² + b²)) × 180/π</code>,
where <code>a</code> and <code>b</code> are the x and y plane
coefficients</li>
<li>
<strong>Aspect</strong> =
<code>(atan2(-a, -b) × 180/π) %% 360</code>, giving compass bearing of
the downslope direction</li>
</ul>
<p>A <strong>stability metric</strong> (<code>slope_range</code>) is
also returned: the 97.5th minus 2.5th percentile of slope estimates
across the top 5% of candidate fits, ranked by inlier count. A low value
means those top candidates agreed closely — the roof surface is planar
and the fit is reliable. A high value suggests the roof geometry is
complex or the data is noisy.</p>
<p><strong><code>thresh</code></strong> (default <code>0.1</code>,
elevation units): The residual distance within which a pixel is counted
as an inlier. Tighten this for high-density LiDAR where rooftop surfaces
are reliably smooth. Loosen it for coarser data where pixel-to-plane
scatter is inherently larger. <em>For scenes with many small buildings,
individual polygons contain fewer pixels, so each pixel carries more
weight — a tighter <code>thresh</code> here helps ensure the fitted
plane is genuinely representative of the roof surface rather than a
statistical accident.</em></p>
<p><strong><code>min_inliers</code></strong> (default <code>10</code>):
Minimum pixels required to accept any candidate plane. For small
buildings with few raster cells, or lower resolution rasters, lower this
to avoid discarding valid fits. For large buildings, raising it ensures
the plane is well-supported across the full footprint. Mostly this
parameter is treated as a fail-safe, and is not meant to be tuned.</p>
<p><strong><code>n_iter</code></strong> (default <code>500</code>):
Number of random 3-point samples evaluated. More iterations improve the
chance of finding the globally best plane. Raise this towards the
ceiling of what computational power will allow for best-fit
estimates.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings_sv</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">valid_polys</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"building_id"</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">buildings_sv</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">buildings_sv</span><span class="op">$</span><span class="va">building_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">buildings_sv</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ransac_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/roof_slope_RANSAC.html">roof_slope_RANSAC</a></span><span class="op">(</span></span>
<span>  raster      <span class="op">=</span> <span class="va">r_filled</span>,</span>
<span>  buildings   <span class="op">=</span> <span class="va">buildings_sv</span>,</span>
<span>  n_iter      <span class="op">=</span> <span class="fl">500L</span>,</span>
<span>  thresh      <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  min_inliers <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>  quiet       <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ransac_result</span><span class="op">$</span><span class="va">summary_table</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  digits  <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Roof slope and aspect estimates. slope_range is the spread of slope values across the top 5% of RANSAC candidate fits — lower values indicate a more stable, reliable plane fit."</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Roof slope and aspect estimates. slope_range is the spread of
slope values across the top 5% of RANSAC candidate fits — lower values
indicate a more stable, reliable plane fit.</caption>
<colgroup>
<col width="16%">
<col width="13%">
<col width="14%">
<col width="13%">
<col width="16%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th align="right">building_id</th>
<th align="right">slope_deg</th>
<th align="right">aspect_deg</th>
<th align="right">n_inliers</th>
<th align="right">slope_range</th>
<th align="right">top_5_percent_count</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">2</td>
<td align="right">24.10</td>
<td align="right">188.95</td>
<td align="right">26</td>
<td align="right">2.58</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">3.50</td>
<td align="right">138.59</td>
<td align="right">20</td>
<td align="right">0.72</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0.24</td>
<td align="right">205.75</td>
<td align="right">1897</td>
<td align="right">0.30</td>
<td align="right">23</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.07</td>
<td align="right">4.31</td>
<td align="right">73</td>
<td align="right">0.26</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">0.42</td>
<td align="right">356.67</td>
<td align="right">585</td>
<td align="right">0.33</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="right">0.06</td>
<td align="right">164.24</td>
<td align="right">784</td>
<td align="right">0.28</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="right">1.34</td>
<td align="right">90.06</td>
<td align="right">813</td>
<td align="right">0.42</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="right">0.09</td>
<td align="right">266.88</td>
<td align="right">828</td>
<td align="right">0.39</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="right">37</td>
<td align="right">4.96</td>
<td align="right">181.46</td>
<td align="right">168</td>
<td align="right">1.04</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="right">41</td>
<td align="right">2.36</td>
<td align="right">228.36</td>
<td align="right">172</td>
<td align="right">0.56</td>
<td align="right">17</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level3">
<h3 id="whats-next">What’s Next?<a class="anchor" aria-label="anchor" href="#whats-next"></a>
</h3>
<p>With per-building height, slope, and aspect values in hand, the
natural next steps are:</p>
<ul>
<li>
<strong>Snow load estimation</strong> — difference two DSMs (pre-
and post-snowfall) within each validated polygon to derive snow depth,
then combine with slope to estimate structural load</li>
<li>
<strong>Spatial aggregation</strong> — summarize risk metrics by
neighborhood, building type, or construction era</li>
<li>
<strong>Validation</strong> — compare derived slope values against
as-built drawings or field measurements to quantify method accuracy</li>
</ul>
<p>All outputs are standard R objects — <code>sf</code> data frames and
<code>terra</code> rasters — and can be written to disk with
<code><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">sf::st_write()</a></code> and <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">terra::writeRaster()</a></code>
respectively.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jashon Newlun.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
